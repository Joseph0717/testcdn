(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7552264e"],{"1a27":function(e,t,i){"use strict";i.r(t),i("99af"),i("4160"),i("c975"),i("d81d"),i("fb6a"),i("a434"),i("b0c0"),i("d3b7"),i("3ca3"),i("159b"),i("ddb0"),i("2b3d");var a=i("2909"),n=i("5530"),r=i("6d7e"),o=i("b2b6"),s=i("a701"),c=i("2fc4"),l=i("c32d"),u=i.n(l),d=i("5880"),p=(l=i("cebe"),i.n(l));d={name:"InvoiceNotSent",i18n:i("9225"),components:{MySearch:c.a},computed:Object(n.a)(Object(n.a)({},Object(d.mapGetters)("account",["file_base","user"])),{},{fields:function(){return[{value:"invoiceNO",label:this.$t("30"),type:"string",default:!0}]}}),data:function(){var e=this;return{invoiceList:[],currencyType:[],minHeight:window.innerHeight-219,loading:!1,pagination:{currentPage:1,pageSize:100,totalResult:0},form:{},rules:{invoiceNO:[{validator:function(t,i,a){""===i?a(new Error(e.$t("55"))):a()},trigger:"change",required:!0}],invoiceDate:[{validator:function(t,i,a){i?a():a(new Error(e.$t("56")))},trigger:"change",required:!0}],supplierCode:[{validator:function(t,i,a){""===i?a(new Error(e.$t("57"))):a()},trigger:"change",required:!0}],invoiceAmount:[{validator:function(t,i,a){""===i?a(new Error(e.$t("58"))):a()},trigger:"change",required:!0}],currency:[{validator:function(t,i,a){""===i?a(new Error(e.$t("59"))):a()},trigger:"change",required:!0}],fileList:[{validator:function(t,i,a){0==e.fileList.length?a(new Error(e.$t("60"))):a()},trigger:"change",required:!1}]},title:"",type:"",visible:!1,confirmLoading:!1,disabled:!1,spinning:!1,invoiceDate:null,fileList:[],fileVisible:!1,fileSpinning:!1,uploadFile:[],dynamicFilter:{}}},created:function(){this.getCurrencyType(),this.getInvoiceList()},methods:{moment:u.a,getCurrencyType:function(){var e=this;Object(s.c)("Currency").then((function(t){1===t.data.code&&(e.currencyType=t.data.data)}))},getInvoiceList:function(){var e=this;this.loading=!0,this.dynamicFilter=this.dynamicFilter||{},this.dynamicFilter.logic="Or",this.dynamicFilter.filters?this.dynamicFilter.filters.push({field:"status",label:"status",operator:"Equal",value:0,filters:[{logic:"And",root:!0,filters:[{field:"createdUserName",label:"createdUserName",operator:"Equal",value:this.user.name}]}]},{field:"status",label:"status",operator:"Equal",value:3,filters:[{logic:"And",root:!0,filters:[{field:"createdUserName",label:"createdUserName",operator:"Equal",value:this.user.name}]}]}):(this.$set(this.dynamicFilter,"filters",[]),this.dynamicFilter.filters.push({field:"status",label:"status",operator:"Equal",value:0,filters:[{logic:"And",filters:[{field:"createdUserName",label:"createdUserName",operator:"Equal",value:this.user.name}]}]},{field:"status",label:"status",operator:"Equal",value:3,filters:[{logic:"And",filters:[{field:"createdUserName",label:"createdUserName",operator:"Equal",value:this.user.name}]}]})),Object(r.c)(this.pagination.currentPage,this.pagination.pageSize,this.dynamicFilter).then((function(t){1===t.data.code&&(e.invoiceList=t.data.data.list,e.invoiceList=e.invoiceList.map((function(e,t){return Object(n.a)(Object(n.a)({},e),{},{sort:t+1})})),e.pagination.totalResult=t.data.data.total,e.loading=!1)}))},handlePageChange:function(e){var t=e.currentPage;e=e.pageSize;this.pagination.currentPage=t,this.pagination.pageSize=e,this.getInvoiceList()},onSearch:function(e){this.dynamicFilter=e,this.pagination.currentPage=1,this.getInvoiceList()},invoiceDateChange:function(e,t){e?(this.invoiceDate=u()(t,"YYYY-MM-DD"),this.form.invoiceDate=new Date(e._d).getTime()):(this.invoiceDate=null,this.form.invoiceDate=0)},showModalAdd:function(){this.title=this.$t("1"),this.type="add",this.visible=!0,this.invoiceDate=null,this.fileList=[],this.form={status:0,invoiceNO:"",invoiceDate:0,supplierCode:"",billingNO:"",invoiceAmount:0,currency:"",remark:""}},handleOk:function(){var e=this;this.$refs.form.validate((function(t){var i;t&&(e.confirmLoading=!0,"add"==e.type&&(i=new FormData,e.fileList.forEach((function(e){i.append("file",e)})),i.append("status",e.form.status),i.append("invoiceNO",e.form.invoiceNO),i.append("invoiceDate",e.form.invoiceDate),i.append("supplierCode",e.form.supplierCode),i.append("billingNO",e.form.billingNO),i.append("invoiceAmount",e.form.invoiceAmount),i.append("currency",e.form.currency),i.append("remark",e.form.remark),Object(r.a)(i).then((function(t){1===t.data.code&&(e.visible=!1,e.getInvoiceList()),e.confirmLoading=!1}))))}))},handleCancel:function(){this.visible=!1,this.confirmLoading=!1},confirmDelete:function(e){var t=this;Object(r.d)(e.id).then((function(e){1===e.data.code&&t.getInvoiceList()}))},send:function(e){var t=this;Object(r.b)(e.id,1).then((function(e){1===e.data.code?(t.$message.success(t.$t("61")),t.getInvoiceList(),t.$refreshPage("/InvoiceSent")):t.$message.error(t.$t("62"))})).catch((function(e){t.$message.error(t.$t("62"))}))},handleRemove:function(e){var t=this.fileList.indexOf(e);e=this.fileList.slice();e.splice(t,1),this.fileList=e},beforeUpload:function(e){return this.fileList=[].concat(Object(a.a)(this.fileList),[e]),!1},fileChange:function(e){e.file.size/1024/1024<30||(this.$message.error(this.$t("63")),this.handleRemove(e.file))},getFile:function(e){var t=this;this.fileSpinning=!0,this.fileVisible=!0,this.uploadFile=[],Object(o.c)(0,0,{fileType:1,referenceID:e.id}).then((function(e){1===e.data.code&&(t.uploadFile=e.data.data.list,t.fileSpinning=!1)}))},download:function(e){var t=e.fileName;p.a.defaults.timeout="",p.a.defaults.responseType="blob";var i=this;i.$notification.open({key:e.id,duration:null,icon:function(e){return e("a-icon",{props:{type:"loading"}})},message:"".concat(i.$t("64"),"-").concat(t)}),Object(o.b)(e.id,{onDownloadProgress:function(a){var n=Math.round(a.loaded/a.total*100);i.$notification.open({key:e.id,duration:null,icon:function(e){return e("a-icon",{props:{type:"loading"}})},message:"".concat(i.$t("64"),"-").concat(t),description:function(e){return e("a-progress",{props:{percent:n}})}})}}).then((function(a){var n;a.data&&(n=window.URL.createObjectURL(new Blob([a.data])),(a=document.createElement("a")).style.display="none",a.href=n,a.setAttribute("download",t),document.body.appendChild(a),a.click(),i.$notification.open({key:e.id,duration:1,icon:function(e){return e("a-icon",{props:{type:"check-circle"}})},message:"".concat(i.$t("65"),"-").concat(t)}),p.a.defaults.timeout=5e3,p.a.defaults.responseType="")})).catch((function(a){p.a.defaults.timeout=5e3,p.a.defaults.responseType="",i.$notification.open({key:e.id,duration:0,icon:function(e){return e("a-icon",{props:{type:"exclamation-circle"}})},message:"".concat(i.$t("66"),"-").concat(t)})}))}}},i("ce87"),i=i("2877"),d=Object(i.a)(d,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"InvoiceNotSent"},[i("vxe-toolbar",{attrs:{custom:"",print:""},scopedSlots:e._u([{key:"tools",fn:function(){return[i("a-space",[i("a-button",{directives:[{name:"auth",rawName:"v-auth:permission",value:"api:admin:invoiceupload:billinginvoiceupload",expression:"`api:admin:invoiceupload:billinginvoiceupload`",arg:"permission"}],attrs:{type:"primary",size:"small"},on:{click:e.showModalAdd}},[i("a-icon",{attrs:{type:"plus-circle"}}),e._v(e._s(e.$t("37")))],1),i("my-search",{attrs:{fields:e.fields},on:{click:e.onSearch}})],1)]},proxy:!0}])}),i("vxe-table",{attrs:{data:e.invoiceList,loading:e.loading,"print-config":{},"show-overflow":"",resizable:"",border:"","highlight-hover-row":"",height:e.minHeight}},[i("vxe-column",{attrs:{field:"sort",title:"#",width:"50"}}),i("vxe-column",{attrs:{field:"invoiceNO",title:e.$t("30")}}),i("vxe-column",{attrs:{field:"invoiceDate",title:e.$t("31")},scopedSlots:e._u([{key:"default",fn:function(t){return t=t.row,[e._v(" "+e._s(e.moment(t.invoiceDate).format("YYYY-MM-DD"))+" ")]}}])}),i("vxe-column",{attrs:{field:"invoiceAmount",title:e.$t("32")}}),i("vxe-column",{attrs:{field:"currency",title:e.$t("33")}}),i("vxe-column",{attrs:{field:"remark",title:e.$t("34")}}),i("vxe-column",{attrs:{field:"status",title:e.$t("35")},scopedSlots:e._u([{key:"default",fn:function(t){return t=t.row,[0==t.status?i("a-tag",{attrs:{color:"#2db7f5"}},[e._v(e._s(e.$t("38")))]):e._e(),1==t.status?i("a-tag",{attrs:{color:"#108ee9"}},[e._v(e._s(e.$t("39")))]):e._e(),2==t.status?i("a-tag",{attrs:{color:"#87d068"}},[e._v(e._s(e.$t("40")))]):e._e(),3==t.status?i("a-tag",{attrs:{color:"#ff4d4f"}},[e._v(e._s(e.$t("41")))]):e._e()]}}])}),i("vxe-column",{attrs:{title:e.$t("36")},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("a-space",[i("a-tooltip",{attrs:{placement:"top",title:e.$t("42")}},[i("a-popconfirm",{attrs:{title:e.$t("43"),"cancel-text":e.$t("11"),"ok-text":e.$t("44")},on:{confirm:function(t){return e.send(a)}}},[i("a-button",{directives:[{name:"auth",rawName:"v-auth:permission",value:"api:admin:invoiceupload:audit",expression:"`api:admin:invoiceupload:audit`",arg:"permission"}],attrs:{type:"primary",size:"small"}},[i("a-icon",{attrs:{type:"check-circle"}})],1)],1)],1),i("a-tooltip",{attrs:{placement:"top",title:e.$t("45")}},[i("a-button",{directives:[{name:"auth",rawName:"v-auth:permission",value:"api:admin:file:getpage",expression:"`api:admin:file:getpage`",arg:"permission"}],attrs:{type:"primary",size:"small"},on:{click:function(t){return e.getFile(a)}}},[i("a-icon",{attrs:{type:"folder"}})],1)],1),i("a-tooltip",{attrs:{placement:"top",title:e.$t("46")}},[i("a-popconfirm",{attrs:{title:e.$t("47"),"cancel-text":e.$t("11"),"ok-text":e.$t("44")},on:{confirm:function(t){return e.confirmDelete(a)}}},[i("a-button",{directives:[{name:"auth",rawName:"v-auth:permission",value:"api:admin:invoiceupload:softdelete",expression:"`api:admin:invoiceupload:softdelete`",arg:"permission"}],attrs:{type:"danger",size:"small"}},[i("a-icon",{attrs:{type:"close-circle"}})],1)],1)],1)],1)]}}])})],1),i("vxe-pager",{attrs:{"current-page":e.pagination.currentPage,"page-size":e.pagination.pageSize,total:e.pagination.totalResult,"page-sizes":[20,50,100,200],layouts:["PrevPage","JumpNumber","NextPage","Sizes","Total"]},on:{"page-change":e.handlePageChange}}),i("a-modal",{attrs:{destroyOnClose:!0,title:e.title,"cancel-text":e.$t("11"),"ok-text":e.$t("44"),centered:"",width:700,visible:e.visible,"confirm-loading":e.confirmLoading,maskClosable:!1,"ok-button-props":{props:{disabled:e.disabled}}},on:{ok:e.handleOk,cancel:e.handleCancel}},[i("template",{slot:"closeIcon"},[i("a-button",{attrs:{type:"danger",size:"small",shape:"circle",icon:"close-circle"}})],1),i("a-spin",{attrs:{spinning:e.spinning}},[i("a-form-model",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-col":{span:5},"wrapper-col":{span:19}}},[i("a-form-model-item",{attrs:{label:e.$t("30"),prop:"invoiceNO"}},[i("a-input",{attrs:{"max-length":30},model:{value:e.form.invoiceNO,callback:function(t){e.$set(e.form,"invoiceNO",t)},expression:"form.invoiceNO"}})],1),i("a-form-model-item",{attrs:{label:e.$t("31"),prop:"invoiceDate"}},[i("a-date-picker",{staticStyle:{width:"50%"},attrs:{format:"YYYY-MM-DD"},on:{change:e.invoiceDateChange},model:{value:e.invoiceDate,callback:function(t){e.invoiceDate=t},expression:"invoiceDate"}})],1),i("a-form-model-item",{attrs:{label:e.$t("32"),prop:"invoiceAmount"}},[i("a-input-number",{staticStyle:{width:"50%"},model:{value:e.form.invoiceAmount,callback:function(t){e.$set(e.form,"invoiceAmount",t)},expression:"form.invoiceAmount"}})],1),i("a-form-model-item",{attrs:{label:e.$t("33"),prop:"currency"}},[i("a-select",{model:{value:e.form.currency,callback:function(t){e.$set(e.form,"currency",t)},expression:"form.currency"}},e._l(e.currencyType,(function(t,a){return i("a-select-option",{key:a,attrs:{value:t.code,disabled:!t.enabled}},[e._v(" "+e._s(t.code)+" ")])})),1)],1),i("a-form-model-item",{attrs:{label:e.$t("34")}},[i("a-input",{attrs:{"max-length":200},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1),i("a-form-model-item",{attrs:{label:e.$t("51"),prop:"fileList"}},[i("a-upload-dragger",{attrs:{accept:".pdf","file-list":e.fileList,remove:e.handleRemove,"before-upload":e.beforeUpload},on:{change:e.fileChange}},[i("p",{staticClass:"ant-upload-drag-icon"},[i("a-icon",{attrs:{type:"inbox"}})],1),i("p",{staticClass:"ant-upload-text"},[e._v("单击或拖动文件到此区域进行上传")])])],1)],1)],1)],2),i("a-modal",{attrs:{destroyOnClose:!0,title:e.$t("53"),footer:null,centered:"",width:700,visible:e.fileVisible,maskClosable:!1},on:{cancel:function(t){e.fileVisible=!1}}},[i("template",{slot:"closeIcon"},[i("a-button",{attrs:{type:"danger",size:"small",shape:"circle",icon:"close-circle"}})],1),i("a-spin",{attrs:{spinning:e.fileSpinning}},[i("a-list",{staticStyle:{"min-height":"30px"},attrs:{size:"small",bordered:"","data-source":e.uploadFile},scopedSlots:e._u([{key:"renderItem",fn:function(t){return i("a-list-item",{},[i("a-list-item-meta",{attrs:{description:t.fileName}}),i("a-space",[i("a-tooltip",{attrs:{placement:"top",title:e.$t("54")}},[i("a-button",{attrs:{type:"primary",size:"small"},on:{click:function(i){return e.download(t)}}},[i("a-icon",{attrs:{type:"download"}})],1)],1)],1)],1)}}])})],1)],2)],1)}),[],!1,null,"5f41c3dc",null).exports;t.default=d},"2fc4":function(e,t,i){"use strict";i("4de4");var a={name:"MySearch",props:{fields:{type:Array,default:function(){return[]}}},data:function(){return{filter:{field:"",value:"",operator:"Contains"}}},created:function(){this.filter.field=this.fields[0].value},methods:{change:function(e){this.filter.field=e},onSearch:function(e){this.filter.value=e,e=this.filter,this.$emit("click",e)}}};i=i("2877"),a=Object(i.a)(a,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("a-input-search",{attrs:{allowClear:""},on:{search:e.onSearch}},[i("a-select",{staticStyle:{"min-width":"100px"},attrs:{slot:"addonBefore"},on:{change:e.change},slot:"addonBefore",model:{value:e.filter.field,callback:function(t){e.$set(e.filter,"field",t)},expression:"filter.field"}},[e._l(e.fields,(function(t){return["string"==t.type?i("a-select-option",{key:t.value,attrs:{value:t.value}},[e._v(" "+e._s(t.label)+" ")]):e._e()]}))],2),i("a-button",{attrs:{slot:"enterButton",icon:"search"},slot:"enterButton"})],1)],1)}),[],!1,null,null,null);t.a=a.exports},"6d7e":function(e,t,i){"use strict";i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return c})),i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return p}));t=i("96cf");var a=i("1da1"),n=i("7424"),r=i("b775");function o(e,t,i){return s.apply(this,arguments)}function s(){return(s=Object(a.a)(regeneratorRuntime.mark((function e(t,i,a){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(r.e)(n.INVOICEUPLOADGETPAGE,r.a.POST,{currentPage:t,pageSize:i,dynamicFilter:a}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function c(e){return l.apply(this,arguments)}function l(){return(l=Object(a.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(r.e)(n.INVOICEUPLOADSOFTDELETE,r.a.DELETE,{id:t}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(e){return d.apply(this,arguments)}function d(){return(d=Object(a.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(r.e)(n.BILLINGINVOICEUPLOAD,r.a.POST,t));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,t,i){return f.apply(this,arguments)}function f(){return(f=Object(a.a)(regeneratorRuntime.mark((function e(t,i,a){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(r.e)(n.INVOICEAUDIT+"?id="+t+"&status="+i+"&comment="+a,r.a.POST));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},a476:function(e,t,i){},ce87:function(e,t,i){"use strict";i("a476")}}]);